<!DOCTYPE html>
<html>
<head>
  <title>LASSI2 Weekly Status</title>
   <link rel="stylesheet" href="weekly_stats.css">
</head>
<body>


<header class="Header" id="header">
	<div class="Header-block">
		<span class="Header-menu" id="header-menu">
		</span>

		<div class="Header-user" id="header-user">

		</div>
		<div class="u-hidden u-lg-block">

      <div class="Titles Titles--hero">
      <h1 class="Titles-main">LASSI2</h1>

      <div class="Titles-sub">Weekly Stats</div>
      </div>
    </div>
	</div>
	<aside class="Header-auth" id="header-auth">
		<div class="Header-embedApi" id="embed-api-auth-container"/>
		<a class="Header-logout" href="https://accounts.google.com/logout">Logout</a>
	</aside>
</header>



<div class="Dashboard Dashboard--full">


  <div class="Screenshot" id="auth-button"></div>


  <ul class="FlexGrid FlexGrid--halves">
  		<li class="FlexGrid-item">
  		  <h1 class="Titles-main">Data Source</h1>
        <div id="view-selector-container"></div>
      </li>

  		<li class="FlexGrid-item">
  		  <h1 class="Titles-main">Primary Comparison Week</h1>
        <div id="date-range-selector-container"></div>
      </li>
  </ul>
  <div class="Screenshot"></div>




  <ul class="FlexGrid">
  		<li class="FlexGrid-item">
  		  <div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Week Session Usage Comparison</h1>
  					<div class="Titles-sub">By sessions</div>
  				</header>
          <figure class="Chartjs-figure" id="weekly-session-chart-container"/>
        </div>
        <div class="Chartjs-legend" id="weekly-session-legend-container"/>
      </li>

  		<li class="FlexGrid-item">
  			<div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Month Session Usage Comparison</h1>
  					<div class="Titles-sub">By sessions</div>
  				</header>
  				<figure class="Chartjs-figure" id="monthly-session-chart-container"/>
  			</div>
  		<div class="Chartjs-legend" id="monthly-session-legend-container"/>
  		</li>

  		<li class="FlexGrid-item">
  		  <div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Week Session Duration Comparison</h1>
  					<div class="Titles-sub">By average session length (seconds)</div>
  				</header>
          <figure class="Chartjs-figure" id="weekly-session-duration-chart-container"/>
        </div>
        <div class="Chartjs-legend" id="weekly-session-duration-legend-container"/>
      </li>
  		<li class="FlexGrid-item">
  			<div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Month Session Duration Comparison</h1>
  					<div class="Titles-sub">By average session length (seconds)</div>
  				</header>
  				<figure class="Chartjs-figure" id="monthly-session-duration-chart-container"/>
  			</div>
  		<div class="Chartjs-legend" id="monthly-session-duration-legend-container"/>
  		</li>

  		<li class="FlexGrid-item">
    		  <div class="Chartjs">
    				<header class="Titles">
    					<h1 class="Titles-main">Week Content Usage Comparison</h1>
    					<div class="Titles-sub">By page views</div>
    				</header>
            <figure class="Chartjs-figure" id="weekly-content-chart-container"/>
          </div>
        <div class="Chartjs-legend" id="weekly-content-legend-container"/>
      </li>

  		<li class="FlexGrid-item">
  			<div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Quaterly Content Usage Comparison</h1>
  					<div class="Titles-sub">By percentage of page views</div>
  				</header>
  				<figure class="Chartjs-figure" id="quarterly-content-chart-container"/>
  			</div>
  		<div class="Chartjs-legend" id="quarterly-content-legend-container"/>
  		</li>

  		<li class="FlexGrid-item">
  		  <div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Week Browser Comparison</h1>
  					<div class="Titles-sub">By page views</div>
  				</header>
          <figure class="Chartjs-figure" id="weekly-browser-chart-container"/>
        </div>
        <div class="Chartjs-legend" id="weekly-browser-legend-container"/>
      </li>

  		<li class="FlexGrid-item">
  			<div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Quarterly Browser Comparison</h1>
  					<div class="Titles-sub">By percentage of page views</div>
  				</header>
  				<figure class="Chartjs-figure" id="quarterly-browser-chart-container"/>
  			</div>
  		<div class="Chartjs-legend" id="quarterly-browser-legend-container"/>
  		</li>

  		<li class="FlexGrid-item">
  		  <div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Week Internet Explorer Comparison</h1>
  					<div class="Titles-sub">By page views</div>
  				</header>
          <figure class="Chartjs-figure" id="weekly-ieversion-chart-container"/>
        </div>
        <div class="Chartjs-legend" id="weekly-ieversion-legend-container"/>
      </li>

  		<li class="FlexGrid-item">
  			<div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Quarterly Internet Explorer Comparison</h1>
  					<div class="Titles-sub">By percentage of page views</div>
  				</header>
  				<figure class="Chartjs-figure" id="quarterly-ieversion-chart-container"/>
  			</div>
  		<div class="Chartjs-legend" id="quarterly-ieversion-legend-container"/>
  		</li>

  		<li class="FlexGrid-item">
  		  <div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Week Firefox Comparison</h1>
  					<div class="Titles-sub">By page views</div>
  				</header>
          <figure class="Chartjs-figure" id="weekly-firefoxversion-chart-container"/>
        </div>
        <div class="Chartjs-legend" id="weekly-firefoxversion-legend-container"/>
      </li>

  		<li class="FlexGrid-item">
  			<div class="Chartjs">
  				<header class="Titles">
  					<h1 class="Titles-main">Quarterly Firefox Comparison</h1>
  					<div class="Titles-sub">By percentage of page views</div>
  				</header>
  				<figure class="Chartjs-figure" id="quarterly-firefoxversion-chart-container"/>
  			</div>
  		<div class="Chartjs-legend" id="quarterly-firefoxversion-legend-container"/>
  		</li>
  </ul>

</div>



<!-- Step 2: Load the library. -->
<script>
(function(w,d,s,g,js,fjs){
  g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(cb){this.q.push(cb)}};
  js=d.createElement(s);fjs=d.getElementsByTagName(s)[0];
  js.src='https://apis.google.com/js/platform.js';
  fjs.parentNode.insertBefore(js,fjs);js.onload=function(){g.load('analytics')};
}(window,document,'script'));
</script>


<script src="javascript/Chart.min.js"></script>

<script src="javascript/moment.min.js"></script>

<!-- Include the ViewSelector2 component script. -->
<script src="javascript/view-selector2.js"></script>

<!-- Include the DateRangeSelector component script. -->
<script src="javascript/date-range-selector.js"></script>

<!-- Include the ActiveUsers component script. -->
<script src="javascript/active-users.js"></script>

<script src="weekly_stats.js"></script>

<script>
gapi.analytics.ready(function() {

  // Step 3: Authorize the user.

  var CLIENT_ID = '940998236407-ll26vtigl8bs52nt0ld3cumii6kmesmg.apps.googleusercontent.com';
  var startDate = moment().startOf('week').subtract(6, 'days').format('YYYY-MM-DD');
  var endDate =  moment().startOf('week').format('YYYY-MM-DD');
  var gaId = 'ga:89463991';
  var accountName = '';


  gapi.analytics.auth.authorize({
    container: 'auth-button',
    clientid: CLIENT_ID,
  });



  gapi.analytics.auth.on('success', function(response) {
      viewSelector.execute();
  });

  /**
   * Create a new DateRangeSelector instance to be rendered inside of an
   * element with the id "date-range-selector-container".
   */

   var dateRangeSelector = new gapi.analytics.ext.DateRangeSelector({
      container: 'date-range-selector-container'
    })
    .set({'start-date': startDate,
      'end-date': endDate})
    .execute();

    dateRangeSelector.on('change', function(data) {
      var newStartDate, newEndDate;

      //check which date was altered and recalculate dates
      if(data['start-date']!=startDate)
        newStartDate = moment(data['start-date']).startOf('week').add(1, 'days').format('YYYY-MM-DD');
      else
        newStartDate = moment(data['end-date']).startOf('week').add(1, 'days').format('YYYY-MM-DD');

      //Set new end date from the calculated start date
      newEndDate = moment(newStartDate).add(6, 'days').format('YYYY-MM-DD');

      dateRangeSelector.set({'start-date': newStartDate, 'end-date': newEndDate}).execute();

      //check if new time period is different to old period
      if(startDate!=newStartDate) {
        startDate = newStartDate;
        endDate =  newEndDate;
        renderCharts();
      }

    });


   /**
   * Create a new ViewSelector2 instance to be rendered inside of an
   * element with the id "view-selector-container".
   */
  var viewSelector = new gapi.analytics.ext.ViewSelector2({
    container: 'view-selector-container'
  });


  //Execute the selector
  viewSelector.execute();


  viewSelector.on('viewChange', function(data) {
    //Check and set whether this is a LASSI2 account
    if(accountName=='' && data.account.name=='LASSI2') {
      accountName = 'LASSI2';
      viewSelector.set({'ids': gaId}).execute();
    }

    gaId = data.ids;
    renderCharts();

  });


  function renderCharts() {
    renderWeekOverWeekChart(gaId, startDate, endDate);
    renderWeekOverWeekSessionDurationChart(gaId, startDate, endDate);
    renderWeekContentUsageChart(gaId, startDate, endDate);
    renderTopBrowsersPeriod(gaId, startDate, endDate);
    renderIEVersionPeriod(gaId, startDate, endDate);
    renderFirefoxVersionPeriod(gaId, startDate, endDate);
  }


  // Set some global Chart.js defaults.
  Chart.defaults.global.animationSteps = 60;
  Chart.defaults.global.animationEasing = 'easeInOutQuart';
  Chart.defaults.global.responsive = true;
  Chart.defaults.global.maintainAspectRatio = false;

});
</script>
</body>
</html>