var LINE_CHART_LEGEND='<% for (var i=0; i<datasets.length; i++) {%><li><i style="background:<%=datasets[i].fillColor%>; border-width: 1px; border-style: solid; border-color:<%=datasets[i].pointColor%>;"></i><%if (datasets[i].label) {%><%=datasets[i].label%><%}%></li><%}%>',BAR_CHART_LEGEND='<% for (var i=0; i<datasets.length; i++) {%><li><i style="background:<%=datasets[i].fillColor%>; border-width: 1px; border-style: solid; border-color:<%=datasets[i].strokeColor%>;"></i><%if (datasets[i].label) {%><%=datasets[i].label%><%}%></li><%}%>',DOUGHNUT_CHART_LEGEND='<% for (var i=0; i<segments.length; i++) {%><li><i style="background:<%=segments[i].fillColor%>; border-width: 1px; border-style: solid; border-color:<%=segments[i].highlightColor%>;"></i><%if (segments[i].label) {%><%=segments[i].label%><%}%></li><%}%>',StatsChart=function(e,t,r){"use strict";this.fillColors=["rgba(115,115,115,0.33)","rgba(241,90,96,0.33)","rgba(122,195,106,0.33)","rgba(90,155,212,0.33)","rgba(250,167,91,0.33)","rgba(158,103,171,0.33)","rgba(193,254,227,0.33)","rgba(215,127,80,0.33)"],this.strokeColors=["rgba(115,115,115,1)","rgba(241,90,96,1)","rgba(122,195,106,1)","rgba(90,155,212,1)","rgba(250,167,91,1)","rgba(158,103,171,1)","rgba(193,254,227,1)","rgba(215,127,80,1)"],this.gaIds=e,this.gaDimensions="",this.gaMetrics="",this.gaFilters="",this.gaSort="",this.currentWeekStartDate=moment(t).format("YYYY-MM-DD"),this.currentWeekStarting=moment(t).format("DD/MM/YYYY"),this.currentWeekEndDate=moment(r).format("YYYY-MM-DD"),this.chartData=[],this.labels=[]};StatsChart.prototype.queryGA=function(e){"use strict";return new Promise(function(t,r){var a=new gapi.analytics.report.Data({query:e});a.once("success",function(e){t(e)}).once("error",function(e){r(e)}).execute()})},StatsChart.prototype.delayExecution=function(){"use strict";return new Promise(function(e){setTimeout(e,200)})},StatsChart.prototype.makeCanvas=function(e){"use strict";var t=document.getElementById(e),r=document.createElement("canvas"),a=r.getContext("2d");return t.innerHTML="",r.width=t.offsetWidth,r.height=t.offsetHeight,t.appendChild(r),a},StatsChart.prototype.createLineChart=function(e,t){"use strict";var r=this,a=new Chart(r.makeCanvas(e)).Line(r.chartData,{legendTemplate:LINE_CHART_LEGEND});document.getElementById(t).innerHTML=a.generateLegend()},StatsChart.prototype.createBarChart=function(e,t){"use strict";var r=this,a=new Chart(r.makeCanvas(e)).Bar(r.chartData,{legendTemplate:BAR_CHART_LEGEND});document.getElementById(t).innerHTML=a.generateLegend()},StatsChart.prototype.createDoughnutChart=function(e,t){"use strict";var r=this,a=new Chart(r.makeCanvas(e)).Doughnut(r.chartData,{percentageInnerCutout:33,animateScale:!0,legendTemplate:DOUGHNUT_CHART_LEGEND});document.getElementById(t).innerHTML=a.generateLegend()};var WeekToPreviousWeekChart=function(e,t,r){"use strict";StatsChart.call(this,e,t,r),this.gaLastYearDimensions="",this.currentWeekData=[],this.previousWeekData=[],this.lastYearData=[],this.lastYearStartDate=moment(r).subtract(1,"years").format("YYYY-MM-DD"),this.lastYearEndDate=moment(r).format("YYYY-MM-DD"),this.lastWeekStartDate=moment(t).subtract(7,"days").format("YYYY-MM-DD"),this.lastWeekEndDate=moment(r).subtract(7,"days").format("YYYY-MM-DD"),this.lastWeekStarting=moment(t).subtract(7,"days").format("DD/MM/YYYY")};WeekToPreviousWeekChart.prototype=Object.create(StatsChart.prototype),WeekToPreviousWeekChart.prototype.constructor=WeekToPreviousWeekChart,WeekToPreviousWeekChart.prototype.transformLastYearDataToMedians=function(e){"use strict";var a,t=this,r={day0:[],day1:[],day2:[],day3:[],day4:[],day5:[],day6:[]};for(e.rows.forEach(function(e){r["day"+e[0]].push(+e[3])}),a=1;7>=a;a++)t.lastYearData.push(void 0===r["day"+a%7]?0:r["day"+a%7][Math.round(r["day"+a%7].length/2)])},WeekToPreviousWeekChart.prototype.retrieveGAData=function(){"use strict";var e=this,t={ids:e.gaIds,dimensions:e.gaLastYearDimensions,metrics:e.gaMetrics,filters:e.gaFilters,"start-date":e.lastYearStartDate,"end-date":e.lastYearEndDate,sort:e.gaSort};return e.queryGA(t).then(function(t){return e.transformLastYearDataToMedians(t),e.delayExecution()}).then(function(){return t={ids:e.gaIds,dimensions:e.gaDimensions,metrics:e.gaMetrics,"start-date":e.currentWeekStartDate,"end-date":e.currentWeekEndDate},e.queryGA(t)}).then(function(t){return e.currentWeekData=t.rows.map(function(e){return+e[2]}),e.delayExecution()}).then(function(){return t["start-date"]=e.lastWeekStartDate,t["end-date"]=e.lastWeekEndDate,e.queryGA(t)}).then(function(t){return e.previousWeekData=t.rows.map(function(e){return+e[2]}),e.labels=t.rows.map(function(e){return+e[0]}),e.labels=e.labels.map(function(e){return moment(e,"YYYYMMDD").format("ddd")}),!0}).catch(function(e){console.log(e.message)})},WeekToPreviousWeekChart.prototype.setUpChartData=function(){"use strict";var e=this;e.chartData={labels:e.labels,datasets:[{label:"Week Starting "+e.lastWeekStarting,fillColor:e.fillColors[0],strokeColor:e.strokeColors[0],pointColor:e.strokeColors[0],pointStrokeColor:"#fff",data:e.previousWeekData},{label:"Week Starting "+e.currentWeekStarting,fillColor:e.fillColors[1],strokeColor:e.strokeColors[1],pointColor:e.strokeColors[1],pointStrokeColor:"#fff",data:e.currentWeekData},{label:"Median for the Last Year",fillColor:e.fillColors[2],strokeColor:e.strokeColors[2],pointColor:e.strokeColors[2],pointStrokeColor:"#fff",data:e.lastYearData}]}};var YearToPreviousYearChart=function(e,t,r){"use strict";StatsChart.call(this,e,t,r),this.currentYearData=[],this.previousYearData=[],this.currentYearStartDate=moment(r).date(1).month(0).format("YYYY-MM-DD"),this.currentYearEndDate=moment(r).format("YYYY-MM-DD"),this.previousYearStartDate=moment(r).subtract(1,"year").date(1).month(0).format("YYYY-MM-DD"),this.previousYearEndDate=moment(r).date(1).month(0).subtract(1,"day").format("YYYY-MM-DD"),this.labels=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};YearToPreviousYearChart.prototype=Object.create(StatsChart.prototype),YearToPreviousYearChart.prototype.constructor=YearToPreviousYearChart,YearToPreviousYearChart.prototype.retrieveGAData=function(){"use strict";var e=this,t={ids:e.gaIds,dimensions:e.gaDimensions,metrics:e.gaMetrics,"start-date":e.currentYearStartDate,"end-date":e.currentYearEndDate};return e.queryGA(t).then(function(t){return e.currentYearData=t.rows.map(function(e){return+e[2]}),e.delayExecution()}).then(function(){return t["start-date"]=e.previousYearStartDate,t["end-date"]=e.previousYearEndDate,e.queryGA(t)}).then(function(t){return e.previousYearData=t.rows.map(function(e){return+e[2]}),e.setUpChartData(),e.createBarChart("monthly-session-chart-container","monthly-session-legend-container"),e.delayExecution()}).then(function(){return!0}).catch(function(e){console.log(e.message)})},YearToPreviousYearChart.prototype.setUpChartData=function(){"use strict";for(var e=this,t=0,r=e.labels.length;r>t;t++)void 0===e.currentYearData[t]&&(e.currentYearData[t]=null),void 0===e.previousYearData[t]&&(e.previousYearData[t]=null);e.chartData={labels:e.labels,datasets:[{label:"Last Year",fillColor:e.fillColors[0],strokeColor:e.strokeColors[0],data:e.previousYearData},{label:"This Year",fillColor:e.fillColors[1],strokeColor:e.strokeColors[1],data:e.currentYearData}]}};var WeekDoughnutChart=function(e,t,r){"use strict";StatsChart.call(this,e,t,r),this.topFiveData=[]};WeekDoughnutChart.prototype=Object.create(StatsChart.prototype),WeekDoughnutChart.prototype.constructor=WeekDoughnutChart,WeekDoughnutChart.prototype.retrieveAndSetUpGAData=function(){"use strict";var e=this,t={ids:e.gaIds,dimensions:e.gaDimensions,metrics:e.gaMetrics,"start-date":e.currentWeekStartDate,"end-date":e.currentWeekEndDate,sort:e.gaSort,"max-results":5};return""!==e.gaFilters&&(t.filters=e.gaFilters),e.queryGA(t).then(function(t){var r=0;return t.totalResults>0?(t.rows.forEach(function(e){r+=+e[1]}),t.rows.forEach(function(t,a){e.topFiveData.push(t[0]),e.chartData.push({value:+t[1],color:e.fillColors[a],highlight:e.strokeColors[a],label:t[0]+": "+t[1]+" ("+Math.round(t[1]/r*100)+"%)"})})):e.chartData.push({value:1,color:e.fillColors[0],highlight:e.strokeColors[0],label:"No data for selected period"}),!0}).catch(function(e){console.log(e.message)})};var QuarterlyChart=function(e,t,r,a,n){"use strict";StatsChart.call(this,e,t,r),this.queryPrefix="",this.pageQuery="",this.pageData={},this.monthLabels=[],this.periodDates=[],this.searchValues=[],this.gaQueryElement=a,n.length>0&&(this.searchValues=n)};QuarterlyChart.prototype=Object.create(StatsChart.prototype),QuarterlyChart.prototype.constructor=YearToPreviousYearChart,QuarterlyChart.prototype.retrieveTopFive=function(){"use strict";var e=this,t={ids:e.gaIds,dimensions:e.gaDimensions,metrics:e.gaMetrics,"start-date":moment().subtract(2,"years").format("YYYY-MM-DD"),"end-date":moment().format("YYYY-MM-DD"),sort:"-ga:pageviews","max-results":5};return""!==e.gaFilters&&(t.filters=e.gaFilters),0===e.searchValues.length?e.queryGA(t).then(function(t){t.totalResults>0&&t.rows.forEach(function(t){e.searchValues.push(t[0])})}).catch(function(e){return console.log(e.message),!1}):e.delayExecution()},QuarterlyChart.prototype.buildQueryAndLabels=function(){"use strict";var e=this;""!==e.queryPrefix&&(e.pageQuery=e.queryPrefix),e.searchValues.forEach(function(t,r){r>0&&(e.pageQuery=e.pageQuery+","),e.pageQuery=e.pageQuery+"ga:"+e.gaQueryElement+"=="+t,e.pageData["val"+r]=[]});for(var t=3,r=0;t>=0;t--,r++)e.monthLabels.push(moment(e.endDate).subtract(3*t+3,"months").date(1).format("MMM")+"-"+moment(e.endDate).subtract(3*t+1,"months").date(1).format("MMM")),e.periodDates.push(moment(e.endDate).subtract(3*t+3,"months").date(1).format("YYYY-MM-DD")),e.periodDates.push(moment(e.endDate).subtract(3*t,"months").date(1).subtract(1,"days").format("YYYY-MM-DD"));return!0},QuarterlyChart.prototype.retrieveGAData=function(){"use strict";var e=this,t={ids:e.gaIds,dimensions:e.gaDimensions,metrics:e.gaMetrics,filters:e.pageQuery,"start-date":e.periodDates[0],"end-date":e.periodDates[1]};return e.queryGA(t).then(function(t){return e.processQuarterlyResults(t),e.delayExecution()}).then(function(){return t["start-date"]=e.periodDates[2],t["end-date"]=e.periodDates[3],e.queryGA(t)}).then(function(t){return e.processQuarterlyResults(t),e.delayExecution()}).then(function(){return t["start-date"]=e.periodDates[4],t["end-date"]=e.periodDates[5],e.queryGA(t)}).then(function(t){return e.processQuarterlyResults(t),e.delayExecution()}).then(function(){return t["start-date"]=e.periodDates[6],t["end-date"]=e.periodDates[7],e.queryGA(t)}).then(function(t){return e.processQuarterlyResults(t),!0}).catch(function(e){console.log(e.message)})},QuarterlyChart.prototype.processQuarterlyResults=function(e){"use strict";var t=this;if(void 0!==e){var r=[];t.searchValues.forEach(function(){r.push(!1)});var a=t.pageData.val0.length;e.totalResults>0&&e.rows.forEach(function(e){var o=t.searchValues.indexOf(e[0]);o>-1&&(r[o]=!0,t.pageData["val"+o][a]=+e[1])});var n=0;t.searchValues.forEach(function(e,o){r[o]===!1?t.pageData["val"+o].push(0):n+=t.pageData["val"+o][a]}),n>0&&t.searchValues.forEach(function(e,r){t.pageData["val"+r][a]=(t.pageData["val"+r][a]/n*100).toFixed(2)})}return!0},QuarterlyChart.prototype.setUpChartData=function(){"use strict";var e=this;e.chartData={labels:e.monthLabels,datasets:[]},e.searchValues.forEach(function(t,r){e.chartData.datasets[r]={label:t,fillColor:e.fillColors[r],strokeColor:e.strokeColors[r],pointColor:e.strokeColors[r],pointStrokeColor:"#fff",data:e.pageData["val"+r]}})};